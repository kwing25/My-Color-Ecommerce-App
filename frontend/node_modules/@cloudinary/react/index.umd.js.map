{"version":3,"file":"index.umd.js","sources":["../src/internal/SDKAnalyticsConstants.ts","../src/AdvancedImage.tsx","../src/AdvancedVideo.tsx"],"sourcesContent":["import React from 'react'\nimport { version } from '../../package.json';\n\nexport const SDKAnalyticsConstants = {\n  sdkSemver: version,\n  techVersion: React.version,\n  sdkCode: 'J'\n};\n","import React from 'react';\nimport { CloudinaryImage } from '@cloudinary/url-gen/assets/CloudinaryImage';\n\nimport {\n  HtmlImageLayer,\n  Plugins,\n  isBrowser,\n  serverSideSrc,\n  cancelCurrentlyRunningPlugins\n} from '@cloudinary/html'\nimport {SDKAnalyticsConstants} from \"./internal/SDKAnalyticsConstants\";\n\ninterface ImgProps {\n  cldImg: CloudinaryImage,\n  plugins?: Plugins,\n  [x: string]: any\n}\n\n/**\n * @mixin ReactSDK\n * @description The Cloudinary React SDK contains components like \\<AdvancedImage\\> to easily render your media assets from Cloudinary.\n * The SDK also comes with support for optional JS plugins that make the components smart, with features like lazy loading, placeholder, accessibility & responsiveness.\n *\n * @example\n * <caption>\n *  Please note that the order of the plugins is important. See {@link https://cloudinary.com/documentation/sdks/js/frontend-frameworks/index.html#plugin-order|Plugin Order} for more details.\n * </caption>\n * // Example\n * import {CloudinaryImage} from \"@cloudinary/url-gen/assets/CloudinaryImage\";\n * import {\n *  AdvancedImage,\n *  accessibility,\n *  responsive,\n *  lazyload,\n *  placeholder\n * } from '@cloudinary/react';\n *\n * const App = () => {\n *\n * const myCld = new Cloudinary({ cloudName: 'demo'});\n * let img = myCld().image('sample');\n *\n *   return (\n *      <div>\n *         <div style={{height: \"1000px\"}}/>\n *         <AdvancedImage\n *            cldImg={img}\n *            plugins={[lazyload(), responsive(100), placeholder()]}\n *         />\n *      </div>\n *   )\n * };\n *\n *\n *\n *\n *\n */\n\n/**\n * @memberOf ReactSDK\n * @type {Component}\n * @description The Cloudinary image component.\n * @prop {CloudinaryImage} cldImg Generated by @cloudinary/url-gen\n * @prop {Plugins} plugins Advanced image component plugins accessibility(), responsive(), lazyload(), placeholder()\n */\nclass AdvancedImage extends React.Component <ImgProps> {\n  imageRef: React.RefObject<HTMLImageElement>;\n  htmlLayerInstance: HtmlImageLayer;\n\n  constructor(props: ImgProps) {\n    super(props);\n    this.imageRef = React.createRef();\n  }\n\n  /**\n   * On mount, creates a new HTMLLayer instance and initializes with ref to img element,\n   * user generated cloudinaryImage and the plugins to be used.\n   */\n  componentDidMount() {\n    this.htmlLayerInstance = new HtmlImageLayer(\n      this.imageRef.current,\n      this.props.cldImg,\n      this.props.plugins,\n      SDKAnalyticsConstants\n    )\n  }\n\n  /**\n   * On update, we cancel running plugins and update image instance with the state of user\n   * cloudinaryImage and the state of plugins.\n   */\n  componentDidUpdate() {\n    cancelCurrentlyRunningPlugins(this.htmlLayerInstance.htmlPluginState);\n    // call html layer to update the dom again with plugins and reset toBeCanceled\n    this.htmlLayerInstance.update(this.props.cldImg, this.props.plugins, SDKAnalyticsConstants)\n  }\n\n  /**\n   * On unmount, we cancel the currently running plugins.\n   */\n  componentWillUnmount() {\n    // Safely cancel running events on unmount.\n    cancelCurrentlyRunningPlugins(this.htmlLayerInstance.htmlPluginState);\n  }\n\n  render() {\n    const {\n      cldImg,\n      plugins,\n      ...otherProps // Assume any other props are for the base element\n    } = this.props;\n    if (isBrowser()) { // On client side render\n      return <img suppressHydrationWarning {...otherProps} ref={this.imageRef} />\n    } else { // on server side render\n      const src = serverSideSrc(\n        this.props.plugins,\n        this.props.cldImg\n      );\n      return <img {...otherProps} src={src} />\n    }\n  }\n}\n\nexport { AdvancedImage };\n","import React, { Component, createRef, EventHandler, MutableRefObject, SyntheticEvent } from 'react';\nimport { CloudinaryVideo } from '@cloudinary/url-gen';\n\nimport {\n  HtmlVideoLayer,\n  Plugins,\n  VideoSources,\n  cancelCurrentlyRunningPlugins\n} from '@cloudinary/html';\n\ntype ReactEventHandler<T = Element> = EventHandler<SyntheticEvent<T>>;\n\ninterface VideoProps {\n  cldVid: CloudinaryVideo,\n  plugins?: Plugins,\n  sources?: VideoSources,\n  innerRef?: ((instance: any) => void) | MutableRefObject<unknown> | null\n\n  // supported video attributes\n  controls?: boolean\n  loop?: boolean,\n  muted?: boolean,\n  poster?: string,\n  preload?: string,\n  autoPlay?: boolean,\n  playsInline?: boolean\n\n  // supported video events\n  onPlay?: ReactEventHandler<any>,\n  onLoadStart?: ReactEventHandler<any>,\n  onPlaying?: ReactEventHandler<any>,\n  onError?: ReactEventHandler<any>,\n  onEnded?: ReactEventHandler<any>\n}\n\nconst VIDEO_ATTRIBUTES_KEYS: string[] = ['controls', 'loop', 'muted', 'poster', 'preload', 'autoplay', 'playsinline'];\n\n/**\n * @memberOf ReactSDK\n * @type {Component}\n * @description The Cloudinary video component.\n * @prop {CloudinaryVideo} transformation Generated by @cloudinary/url-gen\n * @prop {Plugins} plugins Advanced image component plugins lazyload()\n * @prop videoAttributes Optional attributes include controls, loop, muted, poster, preload, autoplay\n * @prop videoEvents Optional video events include play, loadstart, playing, error, ended\n * @prop {VideoSources} sources Optional sources to generate\n * @example\n *  <caption>\n *  Using custom defined resources.\n * </caption>\n * const vid = new CloudinaryVideo('dog', {cloudName: 'demo'});\n * const videoEl = useRef();\n * const sources = [\n *  {\n *    type: 'mp4',\n *    codecs: ['vp8', 'vorbis'],\n *    transcode: videoCodec(auto())\n *  },\n *  {\n *    type: 'webm',\n *    codecs: ['avc1.4D401E', 'mp4a.40.2'],\n *    videoCodec: videoCodec(auto())\n *  }];\n *\n * return <AdvancedVideo cldVid={vid} sources={sources} ref={videoEl} controls />\n */\nclass AdvancedVideo extends Component <VideoProps> {\n  videoRef: MutableRefObject<HTMLVideoElement | null>\n  htmlVideoLayerInstance: HtmlVideoLayer;\n\n  constructor(props: VideoProps) {\n    super(props);\n    this.videoRef = createRef();\n    this.attachRef = this.attachRef.bind(this);\n  }\n\n  /**\n   * On mount, creates a new HTMLVideoLayer instance and initializes with ref to video element,\n   * user generated cloudinaryVideo and the plugins to be used.\n   */\n  componentDidMount() {\n    this.htmlVideoLayerInstance = new HtmlVideoLayer(\n      this.videoRef && this.videoRef.current,\n      this.props.cldVid,\n      this.props.sources,\n      this.props.plugins,\n      this.getVideoAttributes()\n    )\n  }\n\n  /**\n   * On update, we cancel running plugins and update the video instance if the src\n   * was changed.\n   */\n  componentDidUpdate() {\n    cancelCurrentlyRunningPlugins(this.htmlVideoLayerInstance.htmlPluginState);\n    // call html layer to update the dom again with plugins and reset toBeCanceled\n    this.htmlVideoLayerInstance.update(this.props.cldVid, this.props.sources, this.props.plugins, this.getVideoAttributes())\n  }\n\n  /**\n   * On unmount, we cancel the currently running plugins.\n   */\n  componentWillUnmount() {\n    // safely cancel running events on unmount\n    cancelCurrentlyRunningPlugins(this.htmlVideoLayerInstance.htmlPluginState)\n  }\n\n  /**\n   * Returns video attributes.\n   */\n  getVideoAttributes() {\n    const result = {};\n    VIDEO_ATTRIBUTES_KEYS.forEach((key: string) => {\n      if (key in this.props) {\n        result[key] = this.props[key];\n      }\n    });\n\n    return result;\n  }\n\n  /**\n   * Attach both this.videoRef and props.innerRef as ref to the given element.\n   * @param element - the element to attach a ref to\n   */\n  attachRef(element: HTMLVideoElement) {\n    this.videoRef.current = element;\n    const { innerRef } = this.props;\n\n    if (innerRef) {\n      if (innerRef instanceof Function) {\n        innerRef(element);\n      } else {\n        innerRef.current = element;\n      }\n    }\n  };\n\n  render() {\n    const {\n      cldVid,\n      plugins,\n      sources,\n      innerRef,\n      ...videoEvents // Assume any other props are for the base element\n    } = this.props;\n\n    return <video {...videoEvents} ref={this.attachRef} />\n  }\n}\n\nexport { AdvancedVideo };\n"],"names":["SDKAnalyticsConstants","sdkSemver","version","techVersion","React","sdkCode","AdvancedImage","props","imageRef","createRef","componentDidMount","htmlLayerInstance","HtmlImageLayer","current","cldImg","plugins","componentDidUpdate","cancelCurrentlyRunningPlugins","htmlPluginState","update","componentWillUnmount","render","otherProps","isBrowser","suppressHydrationWarning","ref","src","serverSideSrc","Component","VIDEO_ATTRIBUTES_KEYS","AdvancedVideo","videoRef","attachRef","bind","htmlVideoLayerInstance","HtmlVideoLayer","cldVid","sources","getVideoAttributes","result","forEach","key","element","innerRef","Function","videoEvents"],"mappings":"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"}